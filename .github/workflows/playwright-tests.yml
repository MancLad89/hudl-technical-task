name: Playwright Tests

on:
  schedule:
    # Tests schedule - 02:00 UTC, Monday-Friday
    - cron: '0 2 * * 1-5'
  workflow_dispatch:
    inputs:
      email:
        description: 'Email of registered user'
        required: true
        type: string
      password:
        description: 'Password of registered user'
        required: true
        type: string

env:
  GITHUB_CI: "true"
permissions:
  id-token: write
  contents: read
  checks: write
  pull-requests: write

jobs:
  playwright-tests:
    runs-on: ubuntu-latest
    timeout-minutes: 30

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - uses: actions/setup-node@v4
        with:
          node-version: lts/*

      - name: Install dependencies
        run: |
          cd e2e-tests
          npm install

      - name: Install playwright browsers
        run: |
          cd e2e-tests
          npx playwright install --with-deps 

      - name: Run Playwright tests
        run: |
          cd e2e-tests
          export VALID_EMAIL="${{ inputs.email }}"
          export VALID_PASSWORD="${{ inputs.password }}"
          npx playwright test

      - name: Upload test results
        id: upload_step
        uses: actions/upload-artifact@v4
        if: success() || failure()
        with:
          name: regression-test-results-${{ github.run_attempt }}
          include-hidden-files: true
          path: |
            ./e2e-tests/playwright-report/
            ./e2e-tests/test-results/